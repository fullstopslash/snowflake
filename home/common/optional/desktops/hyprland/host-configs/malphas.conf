#==============================================================================
# Hyprland Configuration - malphas
# System-specific settings for this machine
#
# Hardware: Samsung S90D OLED, 4K@120Hz, HDR
# Scale: 2x (effective 1920x1080)
#==============================================================================

#------------------------------------------------------------------------------
# Monitor Configuration
# Samsung S90D OLED - 4K 120Hz with HDR
#------------------------------------------------------------------------------
monitorv2 {
  output =
  mode = 3840x2160@120.00Hz
  position = auto
  scale = 2
  bitdepth = 10
  supports_wide_color = 1
  supports_hdr = 1
  cm = hdr
  # SDR luminance range in HDR mode (nits)
  # BT.1886 standard is 203 nits for SDR in HDR mode
  sdr_min_luminance = 0.025
  sdr_max_luminance = 203
  # Samsung S90D OLED luminance capabilities
  min_luminance = 0.001  # OLED perfect black
  max_luminance = 900    # S90D peak brightness ~800-1000 nits
}

experimental {
  xx_color_management_v4 = true
}

#------------------------------------------------------------------------------
# Device-specific Input
#------------------------------------------------------------------------------
device {
  name = epic-mouse-v1
  sensitivity = -0.5
}

#------------------------------------------------------------------------------
# System-specific Startup
#------------------------------------------------------------------------------
# Rust media-control daemon (35x faster than bash version)
exec-once = ~/projects/media-control/target/release/media-control-daemon start

#------------------------------------------------------------------------------
# Media Control (Rust implementation)
# Path to locally-built binary
#------------------------------------------------------------------------------
$media = ~/projects/media-control/target/release/media-control

# Toggle media-control daemon
bind = $mainMod SHIFT, M, exec, $media daemon status && $media daemon stop || $media daemon start

# Focus media window or launch Jellyfin
bind = $mainMod CTRL, M, exec, $media focus --launch "flatpak run --branch=stable --arch=x86_64 --command=jellyfinmediaplayer com.github.iwalton3.jellyfin-media-player"

# Toggle fullscreen
bind = SUPER CTRL, space, exec, $media fullscreen

# Direct media window positioning (vim-like)
bind = $mainMod CTRL, H, exec, $media move left
bind = $mainMod CTRL, J, exec, $media move down
bind = $mainMod CTRL, K, exec, $media move up
bind = $mainMod CTRL, L, exec, $media move right

# Close media window
bind = $mainMod CTRL, W, exec, $media close

# Media chapter navigation
bind = $mainMod CTRL, comma, exec, $media chapter prev
bind = $mainMod CTRL, period, exec, $media chapter next

# Mark watched
bind = $mainMod CTRL, semicolon, exec, $media mark-watched
bind = $mainMod CTRL SHIFT, return, exec, $media mark-watched
bind = $mainMod CTRL, return, exec, $media mark-watched-and-stop

# Pin and float
bind = $mainMod CTRL, P, exec, $media pin-and-float

#------------------------------------------------------------------------------
# Window Rules - Position/Size (resolution-dependent)
# At scale=2, effective resolution is 1920x1080
# Media window: 640x360, positioned at bottom-right corner
#------------------------------------------------------------------------------
# mpv - size and position for this display
windowrulev2 = size 640 360, class:^(mpv)$
windowrulev2 = move 1273 713, class:^(mpv)$

# Firefox PiP - size and position for this display
windowrulev2 = size 640 360, class:^(firefox)$, title:^(Picture-in-Picture)$
windowrulev2 = move 1273 713, class:^(firefox)$, title:^(Picture-in-Picture)$

#------------------------------------------------------------------------------
# Gamescope (resolution-specific)
# Renders at 1440p, upscales to 4K native
#------------------------------------------------------------------------------
bind = $mainMod, A, exec, ~/.config/hypr/scripts/focus-or-launch.sh class=gamescope -- "STEAM_MULTIPLE_XWAYLANDS=1 DXVK_HDR=1 ENABLE_HDR_WSI=1 gamescope -f -e -h 1440 -H 2160 -r 120.0 --xwayland-count 2 --prefer-vk-device --hdr-itm-enable --hdr-enabled --hdr-debug-force-output --force-grab-cursor -- steam -gamepadui -steamos"
