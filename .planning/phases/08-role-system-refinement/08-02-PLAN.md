# Plan 08-02: Add Task-Based Roles

## Objective

Extend the role system with task-based roles (mediacenter, development) that can compose with hardware roles. A host can be both `roles.laptop = true` AND `roles.development = true`.

## Context

@roles/default.nix - Role option definitions (after 08-01)
@roles/desktop.nix - Hardware role example
@modules/services/ - Available service modules to wire up

## Current State

- Roles are hardware-focused: desktop, laptop, server, pi, tablet, vm, darwin
- No task-based specializations
- Hosts manually enable services like development tools, media apps

## Target State

- Task roles: `development`, `mediacenter`, `gaming`, `homelab`
- Task roles compose with hardware roles
- A laptop can be `roles.laptop + roles.development`
- Task roles enable relevant myModules.* options and set appropriate hostSpec

## Tasks

### Task 1: Create roles/development.nix

**Type:** create
**Files:** `roles/development.nix`
**Action:**
- Define `roles.development` option
- Enable development-related myModules (dev tools, LSPs, etc.)
- Set `hostSpec.isDevelopment = true`
- Import development modules from modules/services/development, modules/apps/development

**Verify:**
```bash
nix-instantiate --parse roles/development.nix
```

### Task 2: Create roles/mediacenter.nix

**Type:** create
**Files:** `roles/mediacenter.nix`
**Action:**
- Define `roles.mediacenter` option
- Enable media services (jellyfin, plex clients, etc.)
- Set hostSpec values appropriate for media consumption
- Focus on playback, not serving (that's server role)

**Verify:**
```bash
nix-instantiate --parse roles/mediacenter.nix
```

### Task 3: Update roles/default.nix to include task roles

**Type:** modify
**Files:** `roles/default.nix`
**Action:**
- Import new task role files
- Add task role options to the roles submodule
- Document the hardware vs task role distinction in comments

**Verify:**
```bash
nix-instantiate --parse roles/default.nix
nix flake check --no-build
```

## Verification

```bash
# Flake check
nix flake check --no-build

# Test a composed role configuration (add to griefling temporarily)
# roles.desktop = true; roles.development = true;
nix build .#nixosConfigurations.griefling.config.system.build.toplevel --dry-run
```

## Success Criteria

- [ ] `roles/development.nix` exists and is functional
- [ ] `roles/mediacenter.nix` exists and is functional
- [ ] Task roles can compose with hardware roles
- [ ] No option conflicts when multiple roles enabled
- [ ] All hosts still build correctly

## Output

Create `08-02-SUMMARY.md` documenting:
- New task roles created
- Composition pattern (how hardware + task roles work together)
- Any additional task roles identified for future
