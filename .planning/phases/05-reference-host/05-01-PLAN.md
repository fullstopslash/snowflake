# Phase 5 Plan 1: Migrate Ghost to Role System

## Context

Ghost is the main desktop workstation (Ryzen 9 5900XT, Radeon RX 5700 XT, 64GB RAM). It currently has a large default.nix with many manually imported optional modules. The goal is to migrate it to use `roles.desktop = true` while preserving all functionality.

Current state:
- ~165 lines in default.nix
- Manually imports ~20 optional modules
- No role assigned
- Hardware-specific configs (AMD GPU, kernel params)
- Host-specific: samba.nix, crypttab for secondary drives

Target state:
- ~50 lines in default.nix (minimal host pattern)
- Uses `roles.desktop = true` for standard desktop config
- Only host-specific quirks remain in default.nix

## Tasks

### 1. Audit current ghost config
- [ ] List all optional modules currently imported
- [ ] Identify which are covered by roles.desktop
- [ ] Identify host-specific quirks that must remain

### 2. Add roles.desktop to ghost
- [ ] Add `roles.desktop = true;`
- [ ] Test that it doesn't conflict with existing imports

### 3. Remove redundant optional imports
- [ ] Remove modules now provided by desktop role
- [ ] Keep only ghost-specific modules
- [ ] Verify all functionality preserved

### 4. Clean up hostSpec
- [ ] Remove options now set by role defaults
- [ ] Keep only host-specific overrides (hdr, yubikey, etc.)

### 5. Document ghost-specific quirks
- [ ] AMD GPU kernel params
- [ ] Secondary drive crypttab
- [ ] Samba config
- [ ] Xbox controller fix

## Success Criteria

- Ghost boots and works identically to before
- default.nix is â‰¤50 lines (excluding comments)
- Uses role system for standard desktop functionality
- Hardware quirks documented

## Files to Modify

- `hosts/nixos/ghost/default.nix` - Migrate to role system
