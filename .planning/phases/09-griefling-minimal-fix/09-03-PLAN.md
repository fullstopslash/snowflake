# Plan 09-03: Enable Modules for Desktop Role and Verify Both Roles

## Objective

Now that modules have enable options (from Plan 09-01), enable them in the desktop role so desktop machines still get full functionality. Verify both griefling (minimal VM) and ghost (full desktop) work correctly.

## Context

@roles/hw-desktop.nix - Desktop role that needs to enable modules
@roles/hw-vm.nix - VM role (should stay minimal)
@hosts/griefling/default.nix - Minimal test VM
@hosts/ghost/default.nix - Full desktop workstation

## Tasks

### Task 1: Enable gaming module in desktop role

- **Type**: feature
- **Files**: roles/hw-desktop.nix
- **Action**:
  1. Add `myModules.apps.gaming.enable = lib.mkDefault true;` in the mkIf cfg.desktop block
- **Verify**: `nix eval .#nixosConfigurations.ghost.config.myModules.apps.gaming.enable` returns true

### Task 2: Enable latex module in desktop role

- **Type**: feature
- **Files**: roles/hw-desktop.nix
- **Action**:
  1. Add `myModules.apps.development.latex.enable = lib.mkDefault true;` in the mkIf cfg.desktop block
- **Verify**: Ghost config includes latex-env

### Task 3: Enable containers module in desktop role

- **Type**: feature
- **Files**: roles/hw-desktop.nix
- **Action**:
  1. Add `myModules.services.development.containers.enable = lib.mkDefault true;` in the mkIf cfg.desktop block
- **Verify**: Ghost config includes docker

### Task 4: Enable CLI tools in desktop role

- **Type**: feature
- **Files**: roles/hw-desktop.nix
- **Action**:
  1. Add `myModules.apps.cli.tools.enable = lib.mkDefault true;` in the mkIf cfg.desktop block
  2. Add `myModules.apps.cli.shell.enable = lib.mkDefault true;` in the mkIf cfg.desktop block
- **Verify**: Ghost has extended CLI tools

### Task 5: Verify griefling is minimal

- **Type**: verification
- **Files**: N/A (verification only)
- **Action**:
  1. Run `nix build .#nixosConfigurations.griefling.config.system.build.toplevel --dry-run 2>&1 | wc -l`
  2. Compare package count before/after changes
  3. Verify no steam, docker, latex in griefling
- **Verify**: Griefling package list is significantly smaller than ghost

### Task 6: Verify ghost still works

- **Type**: verification
- **Files**: N/A (verification only)
- **Action**:
  1. Run `nix build .#nixosConfigurations.ghost.config.system.build.toplevel --dry-run`
  2. Confirm steam, docker, latex are present
- **Verify**: Ghost has full functionality

## Verification

1. Griefling build: `nix build .#nixosConfigurations.griefling.config.system.build.toplevel --dry-run` shows minimal packages
2. Ghost build: `nix build .#nixosConfigurations.ghost.config.system.build.toplevel --dry-run` shows full packages
3. `nix flake check` passes

## Success Criteria

- [ ] Desktop role enables gaming, latex, containers, cli tools
- [ ] VM role does NOT enable these modules by default
- [ ] griefling dry-run shows ~50-100 fewer packages than before
- [ ] ghost dry-run still includes steam, docker, latex

## Output

Create SUMMARY.md documenting package count comparison and verification results
