# Plan 09-04: Commit, Push, and Verify on Griefling Host

## Objective

Commit all changes using jj, push to remote, and verify griefling VM pulls and applies the new minimal config correctly.

## Context

User requested all commits use jj (jujutsu) not git.
Griefling is a VM that should pull new commits and rebuild.

## Tasks

### Task 1: Stage and commit changes with jj

- **Type**: git
- **Files**: All modified files from 09-01 through 09-03
- **Action**:
  1. Run `jj status` to see changes
  2. Run `jj commit -m "fix(roles): add enable options to modules for minimal VM support"`
  3. Include commit message body describing:
     - Added myModules.*.enable options to gaming, latex, containers, cli modules
     - Fixed hw-vm role to not import modules unconditionally
     - Added Ly display manager to vm role
     - Enabled modules in desktop role to maintain functionality
- **Verify**: `jj log -n 1` shows the commit

### Task 2: Push to remote

- **Type**: git
- **Files**: N/A
- **Action**:
  1. Run `jj git push` to push to the default remote
  2. Verify push succeeds
- **Verify**: `jj git fetch` shows up to date

### Task 3: SSH to griefling and pull new config

- **Type**: remote
- **Files**: N/A
- **Action**:
  1. SSH to griefling: `ssh griefling` (or appropriate hostname)
  2. Pull latest: `cd ~/src/nix/nix-config && jj git fetch && jj rebase`
  3. Verify the new commit is present: `jj log -n 3`
- **Verify**: Commit hash matches local
- **Checkpoint**: human-verify - User confirms SSH access and commit visibility

### Task 4: Rebuild griefling with new config

- **Type**: remote
- **Files**: N/A
- **Action**:
  1. On griefling: `sudo nixos-rebuild switch --flake .#griefling`
  2. Monitor for errors
  3. If successful, verify reduced package count
- **Verify**: Rebuild succeeds without errors
- **Checkpoint**: human-verify - User confirms rebuild success

### Task 5: Verify minimal install on griefling

- **Type**: verification
- **Files**: N/A
- **Action**:
  1. On griefling: `which steam` should not find anything
  2. `systemctl status docker` should show not found or inactive
  3. `systemctl status ly` should show active
  4. `which hyprctl` should find hyprland tools
- **Verify**: Steam, Docker absent; Ly, Hyprland present
- **Checkpoint**: human-verify - User confirms services

## Verification

1. Commit pushed to remote
2. Griefling pulled and rebuilt successfully
3. Griefling is minimal: no steam, no docker, no latex
4. Griefling has GUI: Ly + Hyprland work

## Success Criteria

- [ ] Changes committed with jj
- [ ] Push to remote succeeded
- [ ] Griefling pulled new commits
- [ ] Griefling rebuild succeeded
- [ ] Steam/Docker/LaTeX NOT installed on griefling
- [ ] Ly display manager works
- [ ] Hyprland can be launched

## Output

Create SUMMARY.md documenting:
- Commit hashes
- Push status
- Griefling verification results
- Any issues encountered
