---
phase: 05-testing
type: execute
---

<objective>
End-to-end integration testing of all sync scenarios.

Purpose: Verify all bug fixes work and sync is reliable in both directions.
Output: All test scenarios pass, sync suite is production-ready.
</objective>

<execution_context>
@~/.claude/plugins/marketplaces/taches-cc-resources/skills/create-plans/workflows/execute-phase.md
@~/.claude/plugins/marketplaces/taches-cc-resources/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test TW -> Vikunja sync scenarios</name>
  <files>None (testing only)</files>
  <action>
  Run these test scenarios and document results:

  1. **Create task with tags**:
     ```bash
     task add "Test TW->V create" project:SyncTest +alpha +beta
     sleep 3
     # Verify in Vikunja: task exists with labels alpha, beta
     curl -s -H "Authorization: Bearer $TOKEN" "$VIKUNJA_URL/api/v1/tasks?filter=title:Test%20TW" | jq '.[] | {title, labels}'
     ```

  2. **Add tag to existing task**:
     ```bash
     task <id> modify +gamma
     sleep 3
     # Verify: label gamma added in Vikunja
     ```

  3. **Remove tag from task** (critical - this was broken):
     ```bash
     task <id> modify -alpha
     sleep 3
     # Verify: label alpha REMOVED from Vikunja (should only have beta, gamma)
     ```

  4. **Complete task**:
     ```bash
     task <id> done
     sleep 3
     # Verify: task marked done in Vikunja
     ```

  5. **Delete task**:
     ```bash
     task add "Delete test" project:SyncTest
     sleep 2
     task <id> delete
     sleep 3
     # Verify: task deleted in Vikunja
     ```

  Document pass/fail for each scenario.
  </action>
  <verify>All 5 TW->Vikunja scenarios pass</verify>
  <done>TW->Vikunja sync works for create, add tag, remove tag, complete, delete</done>
</task>

<task type="auto">
  <name>Task 2: Test Vikunja -> TW sync scenarios</name>
  <files>None (testing only)</files>
  <action>
  Run these test scenarios (via Vikunja API or UI):

  1. **Create task with labels in Vikunja**:
     ```bash
     # Create task via API
     curl -X PUT -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" \
       "$VIKUNJA_URL/api/v1/projects/<project_id>/tasks" \
       -d '{"title": "Test V->TW create"}'
     # Add labels
     # Trigger label-sync or wait for scheduled sync
     # Verify in TW: task exists with tags
     task project:SyncTest export | jq '.[] | {description, tags}'
     ```

  2. **Add label in Vikunja**:
     ```bash
     # Add label to existing Vikunja task
     # Trigger sync
     # Verify: tag added in TW
     ```

  3. **Remove label in Vikunja** (critical - this was broken):
     ```bash
     # Remove label from Vikunja task
     # Trigger sync
     # Verify: tag REMOVED from TW task
     ```

  Document pass/fail for each scenario.
  </action>
  <verify>All 3 Vikunja->TW scenarios pass</verify>
  <done>Vikunja->TW sync works for create, add label, remove label</done>
</task>

<task type="auto">
  <name>Task 3: Test error handling and resilience</name>
  <files>None (testing only)</files>
  <action>
  Test error scenarios:

  1. **API failure handling**:
     ```bash
     # Temporarily break Vikunja URL
     # Create task, verify it gets queued for retry
     # Fix URL, run retry, verify it syncs
     ```

  2. **Subprocess failure logging**:
     ```bash
     # Try to complete non-existent task
     # Verify error is logged (not silent)
     ```

  3. **No credential exposure**:
     ```bash
     # While sync is running:
     ps aux | grep -E "vikunja|correlate" | grep -v grep
     # Verify no passwords visible in command line
     ```

  4. **Large batch test** (optional, if time permits):
     ```bash
     # Create 50+ tasks quickly
     for i in $(seq 1 50); do task add "Batch test $i" project:BatchTest; done
     # Verify all sync without timeout or error
     ```

  Document pass/fail for each scenario.
  </action>
  <verify>Error handling works, no credential exposure, batch test passes</verify>
  <done>Resilience tests pass, suite is production-ready</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] TW->Vikunja: create, add tag, remove tag, complete, delete all work
- [ ] Vikunja->TW: create, add label, remove label all work
- [ ] Error handling: failures logged, not silent
- [ ] No credentials visible in ps output
- [ ] Batch test completes successfully (50+ tasks)
</verification>

<success_criteria>
- All test scenarios pass
- Bidirectional tag sync confirmed working
- No silent failures
- No credential exposure
- Suite ready for production use
</success_criteria>

<output>
After completion, create `.planning/phases/05-testing/05-01-SUMMARY.md` with:

# Phase 5: Testing & Validation Summary

**All sync scenarios verified working**

## Test Results

### TW -> Vikunja
- [x] Create task with tags: PASS
- [x] Add tag to existing: PASS
- [x] Remove tag (was broken): PASS
- [x] Complete task: PASS
- [x] Delete task: PASS

### Vikunja -> TW
- [x] Create task with labels: PASS
- [x] Add label: PASS
- [x] Remove label (was broken): PASS

### Resilience
- [x] API failure queued for retry: PASS
- [x] Subprocess failure logged: PASS
- [x] No credential exposure: PASS
- [x] Batch test (50 tasks): PASS

## Issues Found
[Any issues discovered during testing]

## Next Step
v1.1 complete. Update BRIEF.md current state and mark milestone.
</output>
